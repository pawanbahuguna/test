version: 2.1
  
jobs:
  build:
    docker:
      - image: circleci/ubuntu
    parameters:
      webhook:
       description: Enter either your Webhook value or use the CircleCI UI to add your token under the 'TELEGRAM_WEBHOOK' env var
       type: string
       default: ${TELEGRAM_WEBHOOK}  

  steps:
    - checkout

    - run:
      name: Provide error if non-bash shell
      command: |
        if [ ! -x /bin/bash ]; then
          echo Bash not installed.
          exit 1
        fi

    - run:
       name: Telegram Notification
       shell: /bin/bash
       command: |
        # Provide error if no webhook is set and error. Otherwise continue
        if [ -z "<< parameters.webhook >>" ]; then
          echo "NO Telegram WEBHOOK SET"
          echo "Please input your TELEGRAM_WEBHOOK value either in the settings for this project, or as a parameter for this orb."
          exit 1
          else
          # Webhook properly set.
          echo Notifying Telegram Channel
        curl -X POST -H 'Content-type: application/json' $TELEGRAM_WEBHOOK/sendMessage?"chat_id=$CHATID&text=$MESSAGE"
